server {
  listen 80;
  server_name _;

  # Root and index file
  root /usr/share/nginx/html;
  index index.html;

  # Gzip compression
  gzip on;
  gzip_vary on;
  gzip_min_length 1024;
  gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;

  location / {
    # Try files in order:
    # 1. The exact file requested
    # 2. The file as a directory with index.html
    # 3. Fallback to index.html for client-side routing
    try_files $uri $uri/ $uri.html /index.html;
  }

  # Static assets caching
  location /_next/static/ {
    expires 1y;
    access_log off;
    add_header Cache-Control "public, immutable";
  }

  # Media: images, icons, video, audio
  location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|webp|woff|woff2|ttf|eot)$ {
    expires 1M;
    access_log off;
    add_header Cache-Control "public";
  }

  # Javascript and CSS files
  location ~* \.(?:css|js)$ {
    expires 1y;
    access_log off;
    add_header Cache-Control "public";
  }

  # Health check endpoint
  location /health {
    access_log off;
    return 200 "healthy\n";
    add_header Content-Type text/plain;
  }
}
